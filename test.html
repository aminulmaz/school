<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Status & Admit Card</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .card-container { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-weight: 600; }
        .status-Submitted { background-color: #e0e7ff; color: #4338ca; }
        .status-Under-Review { background-color: #fef3c7; color: #b45309; }
        .status-Accepted { background-color: #d1fae5; color: #065f46; }
        .status-Rejected { background-color: #fee2e2; color: #991b1b; }

        /* Admit Card Specific Styles for better PDF output */
        #admit-card-content {
            border: 2px solid #e2e8f0; /* Light border around the card */
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 0.75rem; /* Rounded corners */
            position: relative;
            overflow: hidden; /* Ensures background elements don't spill */
        }
        #admit-card-content::before {
            content: '';
            position: absolute;
            top: -50px;
            left: -50px;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, #bfdbfe 0%, transparent 70%); /* Subtle top-left gradient */
            opacity: 0.3;
            z-index: 0;
        }
        #admit-card-content::after {
            content: '';
            position: absolute;
            bottom: -50px;
            right: -50px;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, #d1fae5 0%, transparent 70%); /* Subtle bottom-right gradient */
            opacity: 0.3;
            z-index: 0;
        }
        .admit-card-header {
            background-color: #1e3a8a; /* Dark blue header */
            color: white;
            padding: 1.5rem;
            text-align: center;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 1; /* Ensure header is above pseudo-elements */
        }
        .admit-card-header h2 {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 700; /* font-bold */
        }
        .admit-card-header p {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: #bfdbfe; /* Light blue for subtitle */
        }
        .admit-card-section-title {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            color: #1f2937; /* Gray-800 */
            border-bottom: 2px solid #e5e7eb; /* Light gray border */
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        .admit-card-info p {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px dashed #e5e7eb; /* Dashed line for separation */
        }
        .admit-card-info p:last-child {
            border-bottom: none;
        }
        .admit-card-info strong {
            color: #4b5563; /* Gray-700 */
        }
        .admit-card-photo {
            border: 3px solid #60a5fa; /* Blue border for photo */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .admit-card-instructions {
            background-color: #f9fafb; /* Light background for instructions */
            border: 1px solid #e5e7eb;
            border-left: 4px solid #3b82f6; /* Blue left border */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 2rem;
            position: relative;
            z-index: 1;
        }
        .admit-card-instructions h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e40af; /* Darker blue for instruction title */
            margin-bottom: 0.75rem;
        }
        .admit-card-instructions ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            color: #4b5563;
        }
        .admit-card-instructions li {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto px-4 py-12">
        <!-- Status Check Section -->
        <div id="status-check-section" class="max-w-xl mx-auto bg-white p-8 md:p-12 rounded-2xl card-container">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Check Application Status</h1>
                <p class="text-gray-500 mt-2">Enter your details to view your application status.</p>
            </div>
            <form id="status-form">
                <div class="space-y-6">
                    <div>
                        <label for="applicationNo" class="block text-sm font-medium text-gray-700">Application Number</label>
                        <input type="text" id="applicationNo" class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg" required>
                    </div>
                    <div>
                        <label for="dob" class="block text-sm font-medium text-gray-700">Date of Birth</label>
                        <input type="date" id="dob" class="mt-1 block w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg" required>
                    </div>
                </div>
                <div class="mt-8">
                    <button type="submit" id="check-status-btn" class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition-colors">Check Status</button>
                </div>
            </form>
        </div>

        <!-- Status Display Section -->
        <div id="status-display-section" class="hidden max-w-xl mx-auto bg-white p-8 md:p-12 rounded-2xl card-container mt-8 text-center">
            <h2 class="text-2xl font-bold text-gray-800">Your Application Status</h2>
            <div class="my-6">
                <p class="text-lg text-gray-600">Hello, <span id="status-name" class="font-bold"></span>!</p>
                <p class="mt-2 text-lg text-gray-600">Your application status is:</p>
                <div class="mt-2 inline-block"><span id="status-badge" class="text-lg status-badge"></span></div>
            </div>
            <div id="status-message" class="p-4 bg-gray-100 rounded-lg text-gray-700"></div>
            <button id="download-admit-card-btn" class="hidden mt-6 w-full bg-green-600 text-white font-semibold py-3 rounded-lg hover:bg-green-700 transition-colors">Download Admit Card</button>
            <button id="back-to-check-btn" class="mt-4 w-full bg-gray-600 text-white font-semibold py-3 rounded-lg hover:bg-gray-700 transition-colors">Check Another Application</button>
        </div>

        <!-- Admit Card Display -->
        <div id="admit-card-display" class="hidden max-w-4xl mx-auto bg-white p-8 md:p-12 rounded-2xl card-container mt-8">
             <div id="admit-card-content">
                <div class="admit-card-header">
                    <h2>MZR ACADEMY</h2>
                    <p>Entrance Test - Admit Card</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 relative z-10">
                    <div class="md:col-span-2 space-y-4 text-gray-700 admit-card-info">
                        <h3 class="admit-card-section-title">Candidate Details</h3>
                        <p><strong>Roll Number:</strong> <span id="card-roll-no"></span></p>
                        <p><strong>Candidate Name:</strong> <span id="card-name"></span></p>
                        <p><strong>Date of Birth:</strong> <span id="card-dob"></span></p>
                        <p><strong>Application Number:</strong> <span id="card-app-no"></span></p>
                    </div>
                    <div class="flex flex-col items-center relative z-10">
                        <img id="card-photo" src="https://placehold.co/150x200" alt="Candidate Photo" class="w-36 h-48 object-cover rounded-lg admit-card-photo">
                        <p class="text-sm text-gray-500 mt-2">Candidate Photo</p>
                    </div>
                </div>

                <div class="mt-8 relative z-10">
                    <h3 class="admit-card-section-title">Examination Details</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700 admit-card-info">
                        <p><strong>Exam Date:</strong> <span>September 15, 2025</span></p>
                        <p><strong>Exam Time:</strong> <span>10:00 AM - 12:00 PM</span></p>
                        <p class="md:col-span-2"><strong>Exam Center:</strong> <span>ABC School Main Campus, Auditorium A, 123 School Road, City, State, 12345</span></p>
                    </div>
                </div>

                <div class="admit-card-instructions mt-8">
                    <h3>Important Instructions:</h3>
                    <ul>
                        <li>Candidates must carry this admit card and a valid photo ID to the examination center.</li>
                        <li>Report to the examination center at least 30 minutes before the exam time.</li>
                        <li>No electronic gadgets or study materials are allowed inside the examination hall.</li>
                        <li>Follow all instructions announced by the invigilator.</li>
                        <li>Any form of malpractice will lead to immediate disqualification.</li>
                    </ul>
                </div>
              
             </div>
            <div class="mt-8 text-center">
                <button id="pdf-download-btn" class="bg-green-600 text-white font-semibold py-3 px-8 rounded-lg hover:bg-green-700 transition-colors">Download as PDF</button>
                <button id="back-to-status-btn" class="ml-4 bg-gray-600 text-white font-semibold py-3 px-8 rounded-lg hover:bg-gray-700 transition-colors">Back</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- PASTE YOUR FIREBASE CONFIGURATION OBJECT HERE ---
        const firebaseConfig = {
            apiKey: "AIzaSyCzlbVpsLSQECmVUs5wyaXKy-fz8nfhjkM", // Replace with your actual API Key
            authDomain: "schooladmsn.firebaseapp.com",
            projectId: "schooladmsn",
            storageBucket: "schooladmsn.firebasestorage.app",
            messagingSenderId: "355479237462",
            appId: "1:355479237462:web:8eaba019c00ad8684d5cf7",
            measurementId: "G-LJW1ZQTGSV"
        };
        // --- END OF FIREBASE CONFIGURATION ---

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Sections
        const statusCheckSection = document.getElementById('status-check-section');
        const statusDisplaySection = document.getElementById('status-display-section');
        const admitCardDisplay = document.getElementById('admit-card-display');

        // Forms and Buttons
        const statusForm = document.getElementById('status-form');
        const downloadAdmitCardBtn = document.getElementById('download-admit-card-btn');
        const backToCheckBtn = document.getElementById('back-to-check-btn');
        const pdfDownloadBtn = document.getElementById('pdf-download-btn');
        const backToStatusBtn = document.getElementById('back-to-status-btn');

        let currentApplicationData = null;

        statusForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            // Show a loading indicator (optional, but good for UX)
            const checkStatusBtn = document.getElementById('check-status-btn');
            checkStatusBtn.textContent = 'Checking...';
            checkStatusBtn.disabled = true;

            const appNo = document.getElementById('applicationNo').value.trim();
            const dob = document.getElementById('dob').value;

            if (!appNo || !dob) {
                // Use a custom modal or message box instead of alert
                showCustomAlert("Please enter both Application Number and Date of Birth.");
                checkStatusBtn.textContent = 'Check Status';
                checkStatusBtn.disabled = false;
                return;
            }

            try {
                const q = query(collection(db, "applications"), where("applicationNo", "==", appNo), where("dob", "==", dob));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    showCustomAlert("Invalid details. Please check your Application Number and Date of Birth.");
                    currentApplicationData = null;
                } else {
                    currentApplicationData = querySnapshot.docs[0].data();
                    displayStatus(currentApplicationData);
                }
            } catch (error) {
                console.error("Error fetching application status: ", error);
                showCustomAlert("An error occurred while checking status. Please try again.");
            } finally {
                checkStatusBtn.textContent = 'Check Status';
                checkStatusBtn.disabled = false;
            }
        });

        function displayStatus(data) {
            document.getElementById('status-name').textContent = data.fullName;
            const statusBadge = document.getElementById('status-badge');
            statusBadge.textContent = data.status;
            statusBadge.className = `text-lg status-badge status-${data.status.replace(' ', '-')}`;
            
            const statusMessage = document.getElementById('status-message');
            downloadAdmitCardBtn.classList.add('hidden');

            switch(data.status) {
                case 'Submitted':
                    statusMessage.textContent = 'Your application has been submitted and is awaiting review.';
                    break;
                case 'Under Review':
                    statusMessage.textContent = 'Your application is currently being reviewed by the admission committee.';
                    break;
                case 'Accepted':
                    statusMessage.textContent = 'Congratulations! Your application has been accepted for the entrance test. You can now download your admit card.';
                    downloadAdmitCardBtn.classList.remove('hidden');
                    break;
                case 'Rejected':
                    statusMessage.textContent = 'We regret to inform you that your application was not successful at this time.';
                    break;
                default:
                    statusMessage.textContent = 'Unknown status. Please contact the admissions office for more information.';
            }
            statusCheckSection.classList.add('hidden');
            statusDisplaySection.classList.remove('hidden');
        }

        downloadAdmitCardBtn.addEventListener('click', () => {
            if (currentApplicationData) {
                populateAdmitCard(currentApplicationData);
                statusDisplaySection.classList.add('hidden');
                admitCardDisplay.classList.remove('hidden');
            } else {
                showCustomAlert("No application data found to generate admit card.");
            }
        });

        function populateAdmitCard(data) {
            document.getElementById('card-roll-no').textContent = `ROLL${data.applicationNo.slice(-6)}`; // Example Roll No
            document.getElementById('card-name').textContent = data.fullName;
            document.getElementById('card-dob').textContent = new Date(data.dob + 'T00:00:00').toLocaleDateString('en-GB');
            document.getElementById('card-app-no').textContent = data.applicationNo;
            const photoEl = document.getElementById('card-photo');
            photoEl.src = data.photoUrl;
            photoEl.onerror = () => { photoEl.src = 'https://placehold.co/150x200?text=Photo'; };
        }
        
        pdfDownloadBtn.addEventListener('click', () => {
            const admitCardContent = document.getElementById('admit-card-content');
            // Temporarily hide buttons for PDF generation
            const buttonsToHide = document.querySelectorAll('#admit-card-display button');
            buttonsToHide.forEach(btn => btn.style.display = 'none');

            const opt = {
                margin: 0.5,
                filename: `Admit_Card_${currentApplicationData.applicationNo}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };
            html2pdf().from(admitCardContent).set(opt).save().then(() => {
                // Show buttons again after PDF generation
                buttonsToHide.forEach(btn => btn.style.display = '');
            });
        });

        backToCheckBtn.addEventListener('click', () => {
            statusDisplaySection.classList.add('hidden');
            statusCheckSection.classList.remove('hidden');
            statusForm.reset();
            currentApplicationData = null; // Clear data on reset
        });

        backToStatusBtn.addEventListener('click', () => {
            admitCardDisplay.classList.add('hidden');
            statusDisplaySection.classList.remove('hidden');
        });

        // Custom Alert/Message Box Function (replaces alert())
        function showCustomAlert(message) {
            const existingAlert = document.getElementById('custom-alert-modal');
            if (existingAlert) existingAlert.remove();

            const alertModal = document.createElement('div');
            alertModal.id = 'custom-alert-modal';
            alertModal.className = 'fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center z-50 modal-backdrop';
            alertModal.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Notification</h3>
                    <p class="text-gray-600 mb-6">${message}</p>
                    <button id="custom-alert-ok-btn" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors">OK</button>
                </div>
            `;
            document.body.appendChild(alertModal);

            document.getElementById('custom-alert-ok-btn').addEventListener('click', () => {
                alertModal.remove();
            });
        }

    </script>
</body>
</html>
